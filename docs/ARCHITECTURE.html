<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-Cert 시스템 아키텍처</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }

        h3 {
            color: #555;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h4 {
            color: #666;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 10px;
        }

        .architecture-diagram {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .component {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 5px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .component.frontend {
            background: #9b59b6;
        }

        .component.backend {
            background: #e74c3c;
        }

        .component.database {
            background: #27ae60;
        }

        .component.external {
            background: #f39c12;
        }

        .flow-diagram {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .flow-step {
            background: #ecf0f1;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .flow-step::before {
            content: "→ ";
            color: #3498db;
            font-weight: bold;
            font-size: 1.2em;
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
        }

        pre code {
            background: none;
            color: #ecf0f1;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background: #3498db;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 5px;
        }

        .badge-primary {
            background: #3498db;
            color: white;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #333;
        }

        .toc {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
        }

        .toc h3 {
            margin-top: 0;
            color: #2c3e50;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc li {
            margin-bottom: 8px;
        }

        .toc a {
            color: #3498db;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .tech-item {
            background: #ecf0f1;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            border: 1px solid #bdc3c7;
        }

        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔐 Auto-Cert 시스템 아키텍처</h1>
        <p><strong>ACME 프로토콜 기반 SSL/TLS 인증서 자동 갱신 시스템</strong></p>

        <div class="toc">
            <h3>📑 목차</h3>
            <ul>
                <li><a href="#overview">1. 시스템 개요</a></li>
                <li><a href="#architecture">2. 아키텍처 구조</a></li>
                <li><a href="#components">3. 주요 컴포넌트</a></li>
                <li><a href="#acme-flow">4. ACME 프로토콜 워크플로우</a></li>
                <li><a href="#deployment">5. 배포 구조</a></li>
                <li><a href="#auto-deployment">5. 자동 배포 및 서버 재기동</a></li>
                <li><a href="#deployment">6. 배포 구조</a></li>
                <li><a href="#dns-challenge">7. DNS-01 챌린지 상세</a></li>
                <li><a href="#tech-stack">8. 기술 스택</a></li>
                <li><a href="#security">9. 보안 고려사항</a></li>
            </ul>
        </div>

        <section id="overview">
            <h2>1. 시스템 개요</h2>
            <p>
                Auto-Cert는 <strong>ACME (Automated Certificate Management Environment)</strong> 프로토콜을 사용하여 
                SSL/TLS 인증서를 자동으로 발급, 갱신, 배포하는 시스템입니다. 
                Let's Encrypt를 CA(Certificate Authority)로 사용하며, DNS-01 챌린지 방식을 통해 도메인 소유권을 검증합니다.
            </p>

            <div class="info-box">
                <strong>💡 핵심 기능:</strong>
                <ul>
                    <li>ACME 프로토콜 기반 자동 인증서 발급 및 갱신</li>
                    <li>Let's Encrypt CA 통합</li>
                    <li>DNS-01 챌린지 방식 (Cloudflare API 활용)</li>
                    <li>인증서 만료 전 자동 갱신 (기본 7일 전)</li>
                    <li>만료 임박 시 담당자 이메일 알림</li>
                    <li>다중 도메인 및 와일드카드 인증서 지원</li>
                    <li><strong>🤖 AI Assistant 모듈:</strong> 자연어를 통한 자동 인증서 생성/갱신 및 서버 관리</li>
                    <li><strong>🚀 자동 배포:</strong> 인증서 발급/갱신 후 배포 대상 서버에 자동 배포 및 Nginx 재기동</li>
                </ul>
            </div>
        </section>

        <section id="architecture">
            <h2>2. 아키텍처 구조</h2>
            
            <div class="architecture-diagram">
                <h3>시스템 구성 요소</h3>
                <div style="margin-top: 30px; display: flex; flex-direction: column; align-items: center; gap: 25px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="component frontend">Frontend<br>(GitHub Pages)</div>
                        <div style="font-size: 2em; color: #3498db;">↔</div>
                        <div class="component backend" style="padding: 20px 30px;">
                            <strong>Backend API<br>(Railway)</strong><br>
                            <small style="font-size: 0.75em; opacity: 0.9; display: block; margin-top: 5px;">
                                • Let's Encrypt 연동<br>
                                • Cloudflare API 연동
                            </small>
                        </div>
                        <div style="font-size: 2em; color: #3498db;">↔</div>
                        <div class="component database">PostgreSQL<br>(Railway)</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="component external">Let's Encrypt<br>(ACME Server)</div>
                        <div style="font-size: 2em; color: #3498db;">↔</div>
                        <div style="padding: 10px 20px; background: #f8f9fa; border: 2px dashed #bdc3c7; border-radius: 5px; color: #7f8c8d; font-weight: bold; font-size: 0.9em;">
                            Backend API
                        </div>
                        <div style="font-size: 2em; color: #3498db;">↔</div>
                        <div class="component external">Cloudflare API<br>(DNS Provider)</div>
                    </div>
                </div>
            </div>

            <h3>2.1 배포 구조</h3>
            <table>
                <thead>
                    <tr>
                        <th>컴포넌트</th>
                        <th>배포 플랫폼</th>
                        <th>설명</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Frontend</strong></td>
                        <td>GitHub Pages</td>
                        <td>
                            React 기반 웹 애플리케이션<br>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Backend API</strong></td>
                        <td>Railway</td>
                        <td>
                            Spring Boot 기반 REST API 서버<br>
                            인증서 발급, 갱신, 관리 기능 제공
                        </td>
                    </tr>
                    <tr>
                        <td><strong>PostgreSQL</strong></td>
                        <td>Railway</td>
                        <td>
                            인증서 정보, 서버 정보, 배포 이력 등<br>
                            모든 메타데이터 저장
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="components">
            <h2>3. 주요 컴포넌트</h2>

            <h3>3.1 Frontend (GitHub Pages)</h3>
            <ul>
                <li><strong>기능:</strong> 인증서 관리 대시보드, 모니터링, 설정 관리</li>
                <li><strong>기술:</strong> React</li>
                <li><strong>배포:</strong> GitHub Pages (정적 호스팅)</li>
                <li><strong>연동:</strong> Backend API와 REST API 통신</li>
            </ul>

            <h3>3.2 Backend API (Railway)</h3>
            <ul>
                <li><strong>ACME Client:</strong> Let's Encrypt와 통신하여 인증서 발급/갱신</li>
                <li><strong>DNS Provider:</strong> Cloudflare API를 통한 DNS 레코드 관리</li>
                <li><strong>Certificate Manager:</strong> 인증서 발급, 갱신, 저장 로직</li>
                <li><strong>Renewal Scheduler:</strong> 만료 예정 인증서 자동 갱신 스케줄러 (만료 7일 전)</li>
                <li><strong>Email Notification Service:</strong> 만료 임박 및 갱신 실패 시 담당자 이메일 알림</li>
                <li><strong>Certificate Distribution Service:</strong> 배포 대상 서버에 인증서 자동 배포 및 Nginx 재기동</li>
                <li><strong>AI Assistant Service:</strong> 자연어 기반 인증서 관리 및 서버 관리 자동화</li>
                <li><strong>REST API:</strong> Frontend와 통신하는 API 엔드포인트</li>
            </ul>

            <h3>3.3 AI Assistant 모듈</h3>
            <ul>
                <li><strong>자연어 처리:</strong> 사용자의 자연어 입력을 이해하여 인증서 관리 작업 수행</li>
                <li><strong>인증서 생성:</strong> "example.com 인증서 발급해줘"와 같은 자연어로 인증서 자동 생성</li>
                <li><strong>인증서 갱신:</strong> "example.com 갱신해줘"와 같은 자연어로 인증서 자동 갱신</li>
                <li><strong>인증서 조회:</strong> "만료 예정 인증서 보여줘", "example.com 인증서 상태 확인" 등으로 조회</li>
                <li><strong>서버 관리:</strong> "10.1.1.2 서버 등록해줘"와 같은 자연어로 서버 등록 및 관리</li>
                <li><strong>의도 감지:</strong> 사용자 입력을 분석하여 인증서 생성/갱신/조회/삭제 의도 자동 감지</li>
                <li><strong>확인 프로세스:</strong> 중요한 작업(생성/갱신) 전 사용자 확인 요청으로 안전성 보장</li>
            </ul>

            <h3>3.4 PostgreSQL (Railway)</h3>
            <ul>
                <li><strong>CERTIFICATES:</strong> 인증서 정보 (도메인, 만료일, 인증서 PEM 등)</li>
                <li><strong>SERVERS:</strong> 대상 서버 정보</li>
                <li><strong>DEPLOYMENTS:</strong> 배포 이력</li>
                <li><strong>RENEWAL_HISTORY:</strong> 갱신 이력 및 통계</li>
            </ul>

            <h3>3.5 External Services</h3>
            <ul>
                <li><strong>Let's Encrypt (ACME Server):</strong> 인증서 발급 기관</li>
                <li><strong>Cloudflare API:</strong> DNS-01 챌린지를 위한 DNS 레코드 추가/삭제</li>
            </ul>
        </section>

        <section id="acme-flow">
            <h2>4. ACME 프로토콜 워크플로우</h2>

            <div class="flow-diagram">
                <h3>인증서 발급 프로세스</h3>
                
                <div class="flow-step">
                    <strong>1. 계정 생성 (Account Creation)</strong><br>
                    Backend가 Let's Encrypt ACME 서버에 계정을 생성합니다.
                </div>

                <div class="flow-step">
                    <strong>2. 주문 생성 (Order Creation)</strong><br>
                    발급할 도메인 목록과 함께 인증서 주문을 생성합니다.
                </div>

                <div class="flow-step">
                    <strong>3. 챌린지 요청 (Challenge Request)</strong><br>
                    DNS-01 챌린지 타입을 요청하고, Let's Encrypt로부터 챌린지 정보를 받습니다.
                </div>

                <div class="flow-step">
                    <strong>4. DNS 레코드 추가 (DNS Record Addition)</strong><br>
                    Cloudflare API를 사용하여 <code>_acme-challenge.{domain}</code> TXT 레코드를 추가합니다.
                </div>

                <div class="flow-step">
                    <strong>5. DNS 전파 대기 (DNS Propagation Wait)</strong><br>
                    DNS 레코드가 전파될 때까지 대기합니다 (최대 300초).
                </div>

                <div class="flow-step">
                    <strong>6. 챌린지 검증 (Challenge Validation)</strong><br>
                    Let's Encrypt가 DNS 레코드를 확인하여 도메인 소유권을 검증합니다.
                </div>

                <div class="flow-step">
                    <strong>7. 인증서 발급 (Certificate Issuance)</strong><br>
                    검증 성공 시 인증서가 발급되고, Backend가 인증서를 다운로드합니다.
                </div>

                <div class="flow-step">
                    <strong>8. DNS 레코드 삭제 (DNS Record Cleanup)</strong><br>
                    Cloudflare API를 사용하여 임시로 추가한 DNS 레코드를 삭제합니다.
                </div>

                <div class="flow-step">
                    <strong>9. 인증서 저장 (Certificate Storage)</strong><br>
                    발급된 인증서를 암호화하여 PostgreSQL에 저장합니다.
                </div>
            </div>

            <div class="info-box">
                <strong>🔄 자동 갱신 프로세스:</strong>
                <ul>
                    <li>스케줄러가 매일 만료 예정 인증서를 확인합니다 (기본: 만료 7일 전)</li>
                    <li>만료 예정 인증서가 발견되면 위의 발급 프로세스를 자동으로 실행합니다</li>
                    <li>갱신 성공 시 알림을 전송하고 이력을 기록합니다</li>
                </ul>
            </div>

            <div class="warning-box">
                <strong>📧 만료 임박 알림 시스템:</strong>
                <ul>
                    <li>인증서 만료 임박 시 (기본: 만료 7일 전) 담당자 이메일로 자동 알림 전송</li>
                    <li>갱신 실패 시에도 즉시 담당자에게 알림 전송</li>
                    <li>알림 이메일에는 다음 정보가 포함됩니다:
                        <ul>
                            <li>도메인명</li>
                            <li>만료 예정일</li>
                            <li>갱신 상태 (성공/실패)</li>
                            <li>갱신 실패 시 오류 메시지</li>
                        </ul>
                    </li>
                    <li>담당자 이메일은 인증서 등록 시 설정하거나 시스템 관리자 이메일로 자동 설정됩니다</li>
                </ul>
            </div>
        </section>

        <section id="auto-deployment">
            <h2>5. 자동 배포 및 서버 재기동</h2>

            <h3>5.1 자동 배포 프로세스</h3>
            <p>
                인증서가 발급되거나 갱신되면, 시스템은 자동으로 배포 대상 서버에 인증서를 배포합니다.
                배포 프로세스는 완전 자동화되어 있으며, 사용자의 개입 없이 진행됩니다.
            </p>

            <div class="flow-diagram">
                <h3>자동 배포 워크플로우</h3>
                
                <div class="flow-step">
                    <strong>1. 인증서 발급/갱신 완료</strong><br>
                    ACME 프로토콜을 통해 인증서가 성공적으로 발급되거나 갱신됩니다.
                </div>

                <div class="flow-step">
                    <strong>2. 자동 배포 설정 확인</strong><br>
                    인증서의 <code>autoDeploy</code> 설정을 확인합니다. 활성화된 경우 자동 배포를 진행합니다.
                </div>

                <div class="flow-step">
                    <strong>3. 배포 대상 서버 확인</strong><br>
                    인증서에 연결된 배포 대상 서버 정보를 조회합니다 (IP 주소, SSH 자격증명 등).
                </div>

                <div class="flow-step">
                    <strong>4. SSH 연결 및 인증서 파일 업로드</strong><br>
                    SSH를 통해 서버에 연결하고, 인증서 파일(.crt), 개인키 파일(.key), 체인 파일(.crt)을 배포 경로에 업로드합니다.
                </div>

                <div class="flow-step">
                    <strong>5. Nginx 설정 테스트</strong><br>
                    서버 타입이 Nginx인 경우, <code>nginx -t</code> 명령으로 설정 파일의 유효성을 검증합니다.
                </div>

                <div class="flow-step">
                    <strong>6. Nginx Graceful Reload</strong><br>
                    설정 테스트가 성공하면, <code>nginx -s reload</code> 명령으로 Nginx를 무중단 재기동합니다.
                </div>

                <div class="flow-step">
                    <strong>7. 배포 이력 기록</strong><br>
                    배포 성공/실패 여부와 상세 정보를 데이터베이스에 기록합니다.
                </div>
            </div>

            <div class="success-box">
                <strong>✅ 자동 배포 특징:</strong>
                <ul>
                    <li><strong>완전 자동화:</strong> 인증서 발급/갱신 후 즉시 자동 배포</li>
                    <li><strong>SSH 기반 안전한 배포:</strong> SSH/SCP를 통한 암호화된 파일 전송</li>
                    <li><strong>무중단 재기동:</strong> Nginx graceful reload로 서비스 중단 없이 인증서 적용</li>
                    <li><strong>설정 검증:</strong> 배포 전 Nginx 설정 파일 유효성 검증</li>
                    <li><strong>배포 이력 관리:</strong> 모든 배포 작업의 성공/실패 이력 기록</li>
                    <li><strong>에러 처리:</strong> 배포 실패 시에도 인증서 발급은 성공으로 처리 (나중에 수동 배포 가능)</li>
                </ul>
            </div>

            <h3>5.2 Nginx 재기동 상세</h3>
            <p>
                Nginx 서버 타입의 경우, 인증서 배포 후 자동으로 Nginx를 재기동합니다.
                이 과정은 무중단(Graceful Reload) 방식으로 진행되어 서비스 중단 없이 새 인증서가 적용됩니다.
            </p>

            <h4>재기동 프로세스:</h4>
            <ol>
                <li><strong>설정 파일 검증:</strong>
                    <pre><code>sudo nginx -t</code></pre>
                    설정 파일의 문법 오류 및 경로 유효성을 검증합니다.
                </li>
                <li><strong>Graceful Reload 실행:</strong>
                    <pre><code>sudo nginx -s reload</code></pre>
                    기존 연결을 유지하면서 새 설정을 적용합니다. 서비스 중단 없이 인증서가 갱신됩니다.
                </li>
            </ol>

            <div class="info-box">
                <strong>💡 Nginx 재기동 특징:</strong>
                <ul>
                    <li><strong>무중단 서비스:</strong> <code>nginx -s reload</code>는 기존 연결을 유지하면서 새 설정 적용</li>
                    <li><strong>자동 sudo 처리:</strong> SSH 비밀번호를 사용하여 sudo 명령 자동 실행</li>
                    <li><strong>에러 복구:</strong> 재기동 실패 시에도 인증서 파일은 배포되어 수동 재기동 가능</li>
                    <li><strong>서버 타입별 지원:</strong> Nginx 외에도 Apache, Tomcat, IIS 등 다양한 웹서버 지원 (향후 확장)</li>
                </ul>
            </div>

            <h3>5.3 AI Assistant를 통한 자동 인증서 관리</h3>
            <p>
                AI Assistant 모듈을 통해 자연어로 인증서를 생성하고 갱신할 수 있으며,
                생성/갱신된 인증서는 자동으로 배포 대상 서버에 배포됩니다.
            </p>

            <div class="info-box">
                <strong>🤖 AI Assistant 활용 예시:</strong>
                <ul>
                    <li><strong>인증서 생성 및 자동 배포:</strong>
                        <pre><code>사용자: "example.com 인증서 발급해줘"
AI: [인증서 생성] → [자동 배포] → "✅ 인증서가 발급되고 서버에 배포되었습니다!"</code></pre>
                    </li>
                    <li><strong>인증서 갱신 및 자동 배포:</strong>
                        <pre><code>사용자: "example.com 갱신해줘"
AI: [인증서 갱신] → [자동 배포] → [Nginx 재기동] → "✅ 인증서가 갱신되고 서버에 배포되었습니다!"</code></pre>
                    </li>
                    <li><strong>배포 상태 확인:</strong>
                        <pre><code>사용자: "example.com 배포 상태 확인해줘"
AI: [배포 이력 조회] → "✅ example.com 인증서가 서버에 성공적으로 배포되었습니다."</code></pre>
                    </li>
                </ul>
            </div>

            <div class="warning-box">
                <strong>⚠️ 자동 배포 설정:</strong>
                <ul>
                    <li>인증서 생성/갱신 시 <code>autoDeploy</code> 옵션으로 자동 배포 여부를 설정할 수 있습니다</li>
                    <li>기본값은 <code>true</code>로, 인증서 발급/갱신 시 자동으로 배포됩니다</li>
                    <li>자동 배포가 비활성화된 경우, 수동으로 배포를 실행할 수 있습니다</li>
                </ul>
            </div>
        </section>

        <section id="deployment">
            <h2>6. 배포 구조</h2>

            <h3>6.1 Frontend 배포 (GitHub Pages)</h3>
            <div class="success-box">
                <strong>배포 플랫폼:</strong> GitHub Pages<br>
                <strong>Repository:</strong> <a href="https://github.com/2025-Hanwha-AI-Hackathon/auto-cert-frontend" target="_blank">2025-Hanwha-AI-Hackathon/auto-cert-frontend</a>
            </div>

            <h4>배포 설정:</h4>
            <pre><code># GitHub Pages 설정
1. Repository Settings → Pages
2. Source: GitHub Actions 또는 main branch
3. Custom Domain (선택사항) 설정
4. 환경 변수 설정 (Backend API URL 등)</code></pre>

            <h3>6.2 Backend 및 PostgreSQL 배포 (Railway)</h3>
            <div class="success-box">
                <strong>배포 플랫폼:</strong> Railway<br>
                <strong>서비스:</strong> Backend API + PostgreSQL Database
            </div>

            <h4>Railway 배포 설정:</h4>
            <ol>
                <li><strong>PostgreSQL 서비스 생성</strong>
                    <ul>
                        <li>Railway 대시보드에서 PostgreSQL 템플릿 선택</li>
                        <li>자동으로 데이터베이스 URL 생성</li>
                    </ul>
                </li>
                <li><strong>Backend API 서비스 생성</strong>
                    <ul>
                        <li>GitHub Repository 연결</li>
                        <li>Build Command: <code>./gradlew :api:bootJar</code></li>
                        <li>Start Command: <code>java -jar api/build/libs/api-1.0.0.jar</code></li>
                    </ul>
                </li>
                <li><strong>환경 변수 설정</strong>
                    <pre><code># Database
DATABASE_URL=${POSTGRES_URL}
DATABASE_USERNAME=${POSTGRES_USER}
DATABASE_PASSWORD=${POSTGRES_PASSWORD}

# ACME
ACME_DIRECTORY_URL=https://acme-v02.api.letsencrypt.org/directory
ACME_ACCOUNT_EMAIL=your-email@example.com
ACME_DEFAULT_CHALLENGE_TYPE=DNS_01

# Cloudflare
CLOUDFLARE_API_TOKEN=your_cloudflare_api_token

# Certificate Encryption
CERTIFICATE_ENCRYPTION_KEY=your_base64_encryption_key

# Email Notification (SMTP)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your_app_password
SMTP_FROM=noreply@example.com</code></pre>
                </li>
            </ol>

            <div class="warning-box">
                <strong>⚠️ 중요:</strong>
                <ul>
                    <li>Railway의 PostgreSQL은 자동으로 <code>POSTGRES_URL</code> 환경 변수를 제공합니다</li>
                    <li>Cloudflare API Token은 Railway의 Secrets에 안전하게 저장해야 합니다</li>
                    <li>인증서 암호화 키는 절대 변경하지 마세요 (기존 인증서 복호화 불가)</li>
                </ul>
            </div>
        </section>

        <section id="dns-challenge">
            <h2>7. DNS-01 챌린지 상세</h2>

            <h3>7.1 DNS-01 챌린지란?</h3>
            <p>
                DNS-01 챌린지는 도메인의 DNS 레코드에 특정 TXT 레코드를 추가하여 도메인 소유권을 증명하는 방식입니다.
                Let's Encrypt가 해당 DNS 레코드를 조회하여 검증합니다.
            </p>

            <div class="info-box">
                <strong>DNS-01 챌린지 장점:</strong>
                <ul>
                    <li>✅ 와일드카드 인증서 지원 (<code>*.example.com</code>)</li>
                    <li>✅ 내부 서버도 인증서 발급 가능 (외부 HTTP 접근 불필요)</li>
                    <li>✅ 완전 자동화 (수동 개입 없음)</li>
                    <li>✅ 다중 도메인/서브도메인 지원</li>
                </ul>
            </div>

            <h3>7.2 Cloudflare API 통합</h3>
            <p>
                시스템은 Cloudflare API를 사용하여 DNS 레코드를 자동으로 추가/삭제합니다.
            </p>

            <h4>필요한 Cloudflare 권한:</h4>
            <ul>
                <li><strong>Zone.DNS.Edit:</strong> DNS 레코드 추가/삭제</li>
                <li><strong>Zone.Zone.Read:</strong> Zone 정보 조회</li>
            </ul>

            <h4>API Token 생성 방법:</h4>
            <ol>
                <li>Cloudflare 대시보드 접속: <a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank">https://dash.cloudflare.com/profile/api-tokens</a></li>
                <li>"Create Token" 클릭</li>
                <li>"Edit zone DNS" 템플릿 선택 또는 Custom Token 생성</li>
                <li>권한 설정: <code>Zone - DNS - Edit</code>, <code>Zone - Zone - Read</code></li>
                <li>Zone Resources: 특정 Zone 또는 All zones 선택</li>
                <li>토큰 생성 후 복사 (한 번만 표시됨)</li>
            </ol>

            <h3>7.3 DNS 레코드 형식</h3>
            <p>
                Let's Encrypt가 요청하는 DNS 레코드는 다음과 같은 형식입니다:
            </p>
            <pre><code>레코드 이름: _acme-challenge.{domain}
레코드 타입: TXT
레코드 값: {challenge_token} (Let's Encrypt가 제공)</code></pre>

            <p><strong>예시:</strong></p>
            <pre><code>도메인: example.com
DNS 레코드: _acme-challenge.example.com
TXT 값: abc123def456ghi789...</code></pre>

            <h3>7.4 DNS 전파 대기</h3>
            <p>
                DNS 레코드를 추가한 후, Let's Encrypt가 레코드를 조회할 수 있을 때까지 대기해야 합니다.
                시스템은 다음과 같이 동작합니다:
            </p>
            <ul>
                <li>DNS 레코드 추가 후 20초 대기</li>
                <li>Google Public DNS (8.8.8.8)로 DNS 전파 확인</li>
                <li>10초 간격으로 재시도 (최대 300초)</li>
                <li>전파 확인 후 Let's Encrypt에 챌린지 검증 요청</li>
            </ul>
        </section>

        <section id="tech-stack">
            <h2>8. 기술 스택</h2>

            <h3>8.1 Frontend</h3>
            <div class="tech-stack">
                <span class="tech-item">React</span>
                <span class="tech-item">GitHub Pages</span>
                <span class="tech-item">REST API</span>
            </div>

            <h3>8.2 Backend</h3>
            <div class="tech-stack">
                <span class="tech-item">Java 21</span>
                <span class="tech-item">Spring Boot 3.5.7</span>
                <span class="tech-item">Gradle 8.14.3</span>
                <span class="tech-item">acme4j</span>
                <span class="tech-item">PostgreSQL Driver</span>
                <span class="tech-item">LangChain4j</span>
                <span class="tech-item">AI Assistant</span>
            </div>

            <h3>8.3 Database</h3>
            <div class="tech-stack">
                <span class="tech-item">PostgreSQL 16</span>
                <span class="tech-item">Flyway (Migration)</span>
                <span class="tech-item">JPA / Hibernate</span>
            </div>

            <h3>8.4 External Services</h3>
            <div class="tech-stack">
                <span class="tech-item">Let's Encrypt (ACME)</span>
                <span class="tech-item">Cloudflare API</span>
            </div>

            <h3>8.5 배포 플랫폼</h3>
            <div class="tech-stack">
                <span class="tech-item">GitHub Pages</span>
                <span class="tech-item">Railway</span>
            </div>
        </section>

        <section id="security">
            <h2>9. 보안 고려사항</h2>

            <h3>9.1 인증서 암호화</h3>
            <p>
                발급된 인증서의 개인키는 AES-256 암호화를 통해 데이터베이스에 저장됩니다.
                암호화 키는 환경 변수로 관리하며, 절대 변경하지 않아야 합니다.
            </p>

            <h3>9.2 API 토큰 관리</h3>
            <ul>
                <li>Cloudflare API Token은 Railway Secrets에 안전하게 저장</li>
                <li>최소 권한 원칙 적용 (Zone.DNS.Edit만 부여)</li>
                <li>정기적인 토큰 갱신 권장 (3-6개월)</li>
            </ul>

            <h3>9.3 환경 변수 보호</h3>
            <ul>
                <li>민감한 정보는 환경 변수로 관리</li>
                <li>Git 저장소에 커밋하지 않음</li>
                <li>Railway Secrets 기능 활용</li>
            </ul>

            <h3>9.4 HTTPS 통신</h3>
            <ul>
                <li>Frontend와 Backend 간 통신은 HTTPS 사용</li>
                <li>CORS 설정으로 허용된 Origin만 접근 가능</li>
                <li>API 인증 및 권한 관리</li>
            </ul>

            <div class="warning-box">
                <strong>⚠️ 보안 체크리스트:</strong>
                <ul>
                    <li>✅ Cloudflare API Token이 Railway Secrets에 저장되어 있는가?</li>
                    <li>✅ 인증서 암호화 키가 안전하게 관리되고 있는가?</li>
                    <li>✅ 데이터베이스 연결이 SSL/TLS로 암호화되어 있는가?</li>
                    <li>✅ API 엔드포인트에 인증/인가가 적용되어 있는가?</li>
                    <li>✅ 환경 변수가 Git에 커밋되지 않았는가?</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>10. 데이터 흐름도</h2>
            <div class="flow-diagram">
                <h3>전체 시스템 데이터 흐름</h3>
                
                <pre style="background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 5px; overflow-x: auto;">
┌─────────────────┐
│   Frontend      │
│ (GitHub Pages)  │
└────────┬────────┘
         │ HTTPS / REST API
         ▼
┌─────────────────┐
│   Backend API   │
│    (Railway)    │
└────────┬────────┘
         │
         ├─────────────────┐
         │                 │
         ▼                 ▼
┌──────────────┐  ┌──────────────────┐
│ PostgreSQL   │  │  Let's Encrypt   │
│  (Railway)   │  │   (ACME Server)  │
│              │  └────────┬──────────┘
│ (메타데이터) │           │
└──────────────┘           │ ACME Protocol
                            │ (DNS-01 Challenge)
                            ▼
                     ┌──────────────────┐
                     │ Cloudflare API   │
                     │  (DNS Provider)  │
                     └────────┬──────────┘
                              │
                              │ (DNS 레코드 추가/삭제)
                              │
                              ▼
                     ┌──────────────────┐
                     │   PostgreSQL     │
                     │    (Railway)    │
                     │  (인증서 저장)   │
                     └────────┬──────────┘
                              │
                              │ (인증서 발급/갱신 완료)
                              │ (자동 배포 트리거)
                              │
                              ▼
                     ┌──────────────────┐
                     │   Backend API    │
                     │ (배포 서비스)    │
                     └────────┬──────────┘
                              │
                              │ SSH/SCP
                              │ (인증서 파일 업로드)
                              │
                              ▼
                     ┌──────────────────┐
                     │  배포 대상 서버  │
                     │   (Nginx 등)    │
                     │                 │
                     │ • 인증서 파일 배포 │
                     │ • nginx -t (설정 검증) │
                     │ • nginx -s reload (재기동) │
                     └────────┬──────────┘
                              │
                              │ (배포 완료)
                              │
                              ▼
                     ┌──────────────────┐
                     │   PostgreSQL     │
                     │  (배포 이력 저장) │
                     └──────────────────┘
                </pre>
            </div>
        </section>

        <footer>
            <p><strong>Auto-Cert 시스템 아키텍처 문서</strong></p>
            <p>버전: 1.0.0 | 최종 수정일: 2025-11-20</p>
            <p>© 2025 Auto-Cert Development Team</p>
        </footer>
    </div>
</body>
</html>
