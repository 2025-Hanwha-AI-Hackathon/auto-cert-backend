sequenceDiagram
    participant Scheduler
    participant CertMgr as Certificate Manager
    participant ACME as ACME Server
    participant DNS
    participant DB as Database
    participant Notify as Notification Service

    Scheduler->>CertMgr: Check expiring certificates
    CertMgr->>DB: Query certificates (expire < 30 days)
    DB-->>CertMgr: Certificate list

    loop For each certificate
        CertMgr->>ACME: Request certificate renewal
        ACME-->>CertMgr: Challenge (DNS-01/HTTP-01)

        alt DNS Challenge
            CertMgr->>DNS: Create TXT record
            DNS-->>CertMgr: Record created
        else HTTP Challenge
            CertMgr->>CertMgr: Setup challenge response
        end

        CertMgr->>ACME: Challenge ready
        ACME->>ACME: Verify challenge
        ACME-->>CertMgr: Issue certificate

        CertMgr->>DB: Store new certificate
        CertMgr->>Notify: Send success notification
    end